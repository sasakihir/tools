# 概要

Windowsでnetstatの結果を取得する

# フォルダ構成

```
netstat_a
|   README.md  
|   netstat_a.bat
|  
\---log  
        netstat-an.yyyymmddhhmmss.log
        netstat-es.yyyymmddhhmmss.log
        netstat-anbo.yyyymmddhhmmss.log
```

logフォルダ以下は、バッチ実行時に生成される

# 仕様

- 指定した間隔で、指定回数netstatを取得する。

# 前提

- なし

# 準備

- netstat_a.batを適当なフォルダに配置する
- netstat_a.batをエディタで開き、以下をセットする

```
set waits=<netstatの取得間隔(秒)>  
set times=<netstatの取得回数>  
```

# 実行の仕方-1. 手動実行

- スケジュール実行する場合でも、最初に手動実行でテストすることを推奨する
- netstat_a.batを管理者実行する
- log配下に3つのファイルが出力されるので、内容が記録されているか確認する

# 実行の仕方-2. スケジュール実行
## 準備

- 以下手順でタスクスケジューラ登録をする

- タスクスケジューラ起動 (コントロールパネル > コンピュータの管理などから)
- タスクを作成するフォルダを開く (タスクスケジューラライブラリなど)
- 右ペインからタスクの作成をクリック

```
[全般タブ]  
・名前: 任意 (ex. netstat_a)  
  
セキュリティオプション  
・タスクの実行時に使うユーザーアカウント: 作業用ユーザが指定されてるか確認  
・ユーザーがログオンしているかどうかにかかわらず実行する、にチェック  
・最上位の特権で実行する、にチェック  
他はデフォルトのままでOK  
  
[トリガー]タブ  
・タスクの開始: スケジュールに従う  
  
設定  
・取得要件に応じて、1回または毎日などを選択  
・開始: netstat取得開始日時を指定  
タイムゾーンにまたがって同期、はチェックしなくて大丈夫  
他はデフォルトのままでOK  
  
[操作]タブ  
netstat_a.batを指定  
  
(登録完了)  
OKをクリックして、タスク実行用に指定したユーザのパスワードを入力して閉じる  
```

- タスクを手動実行する
- ファイルが出力されたことを確認する

## スケジュール実行動作確認

- タスクスケジューラで指定した日時を過ぎたあと、ファイルが正常に出力されたことを確認する

# 動作確認済み環境

- Windows 10

# トラブルシューティング

- なし